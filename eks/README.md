# Amazon SageMaker HyperPod EKS

EKS ê¸°ë°˜ Amazon SageMaker HyperPodë¥¼ í™œìš©í•œ ëŒ€ê·œëª¨ AI/ML ëª¨ë¸ í›ˆë ¨ ë° ì¶”ë¡ ì˜ ê°€ì´ë“œì…ë‹ˆë‹¤.

## ğŸ“š ëª©ì°¨

- [HyperPod EKSë€?](#hyperpod-eksë€)
- [Getting Started](#getting-started)
- [ì•„í‚¤í…ì²˜ ê°œìš”](#ì•„í‚¤í…ì²˜-ê°œìš”)
- [Slurm vs EKS ë¹„êµ](#slurm-vs-eks-ë¹„êµ)

---

## HyperPod EKSë€?

**Amazon SageMaker HyperPod EKS**ëŠ” ëŒ€ê·œëª¨ íŒŒìš´ë°ì´ì…˜ ëª¨ë¸ì˜ í›ˆë ¨ê³¼ ì¶”ë¡ ì„ ìœ„í•´ ì„¤ê³„ëœ ê´€ë¦¬í˜• Kubernetes ê¸°ë°˜ AI ì¸í”„ë¼ì…ë‹ˆë‹¤. ê¸°ì¡´ Slurm ê¸°ë°˜ HyperPodì˜ ë³µì›ë ¥(resiliency)ê³¼ Kubernetesì˜ ìœ ì—°ì„±ì„ ê²°í•©í•˜ì—¬, ì „ì²´ ëª¨ë¸ ë¼ì´í”„ì‚¬ì´í´(í›ˆë ¨ â†’ íŒŒì¸íŠœë‹ â†’ ì¶”ë¡ )ì„ í•˜ë‚˜ì˜ í†µí•© í´ëŸ¬ìŠ¤í„°ì—ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### í•µì‹¬ ê°€ì¹˜

| ì¸¡ë©´ | ì„¤ëª… |
|------|------|
| **ë³µì›ë ¥** | ìë™ ë…¸ë“œ ë³µêµ¬, Deep Health Checks, Job Auto-Resume |
| **ìƒì‚°ì„±** | Kubernetes ë„¤ì´í‹°ë¸Œ ë„êµ¬(kubectl, Helm), Python SDK ì§€ì› |
| **íš¨ìœ¨ì„±** | í›ˆë ¨/ì¶”ë¡  ë¦¬ì†ŒìŠ¤ í†µí•©, Task Governanceë¡œ 30% ë¹„ìš© ì ˆê° |
| **í™•ì¥ì„±** | Karpenter ìë™ ìŠ¤ì¼€ì¼ë§, ìˆ˜ì²œ GPU ì§€ì› |

---

## Getting Started

HyperPod EKSë¥¼ ì‹œì‘í•˜ëŠ” ë¹ ë¥¸ ê°€ì´ë“œì…ë‹ˆë‹¤. ê° ë‹¨ê³„ëŠ” ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰ ê°€ëŠ¥í•˜ë©°, í•„ìš”í•œ ë¶€ë¶„ë§Œ ì„ íƒí•˜ì—¬ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 1. Setup (í´ëŸ¬ìŠ¤í„° ì„¤ì •)

HyperPod EKS í´ëŸ¬ìŠ¤í„°ë¥¼ ìƒì„±í•˜ê³  ê¸°ë³¸ êµ¬ì„±ì„ ì™„ë£Œí•©ë‹ˆë‹¤.

```bash
# í´ëŸ¬ìŠ¤í„° ìƒì„± (CloudFormation ë˜ëŠ” AWS CLI)
aws sagemaker create-cluster \
  --cluster-name my-hyperpod-cluster \
  --orchestrator Type=EKS

# kubeconfig ì„¤ì •
aws sagemaker update-kubeconfig --cluster-name my-hyperpod-cluster

# ê¸°ë³¸ êµ¬ì„±
cd setup
./1.create-config-workshop
./2.setup-eks-access.sh
./3.validate-cluster.sh
```

**ìƒì„¸ ê°€ì´ë“œ:** [setup/README.md](./setup/README.md)

### 2. Training (ëª¨ë¸ í›ˆë ¨)

Kubeflow Training Operatorë¥¼ ì‚¬ìš©í•œ ë¶„ì‚° í›ˆë ¨ ì‹¤í–‰

```bash
# PyTorchJob ì œì¶œ
kubectl apply -f training/pytorchjob-example.yaml

# í›ˆë ¨ ìƒíƒœ í™•ì¸
kubectl get pytorchjobs
kubectl logs -f pytorch-training-worker-0
```

**ìƒì„¸ ê°€ì´ë“œ:** [training/README.md](./training/README.md)

### 3. Inference (ëª¨ë¸ ì¶”ë¡ )

Inference Operatorë¥¼ í†µí•œ ì¶”ë¡  ì—”ë“œí¬ì¸íŠ¸ ë°°í¬

```bash
# ì¶”ë¡  ì—”ë“œí¬ì¸íŠ¸ ìƒì„±
kubectl apply -f inference/vllm-endpoint.yaml

# ì—”ë“œí¬ì¸íŠ¸ URL í™•ì¸
kubectl get inferenceendpoint

# ì¶”ë¡  í…ŒìŠ¤íŠ¸
curl -X POST https://<endpoint-url>/v1/completions \
  -H "Content-Type: application/json" \
  -d '{"prompt": "Hello", "max_tokens": 50}'
```

**ìƒì„¸ ê°€ì´ë“œ:** [inference/README.md](./inference/README.md)

### 4. Task Governance (ë¦¬ì†ŒìŠ¤ ê´€ë¦¬)

íŒ€ë³„ ë¦¬ì†ŒìŠ¤ í• ë‹¹ ë° ìš°ì„ ìˆœìœ„ ê´€ë¦¬ë¡œ ë¹„ìš© ìµœì í™”

```bash
# ResourceFlavor ë° ClusterQueue ì„¤ì •
kubectl apply -f task-governance/resource-config.yaml

# íŒ€ë³„ LocalQueue ìƒì„±
kubectl apply -f task-governance/team-queue.yaml

# ì‘ì—… ì œì¶œ ì‹œ í ì§€ì •
kubectl apply -f training/job-with-queue.yaml
```

**ìƒì„¸ ê°€ì´ë“œ:** [task-governance/README.md](./task-governance/README.md)

---

## ì•„í‚¤í…ì²˜ ê°œìš”

### HyperPod EKS ì „ì²´ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Amazon SageMaker HyperPod                      â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Amazon EKS Cluster                      â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚  â”‚
â”‚  â”‚  â”‚  Training Pods   â”‚  â”‚  Inference Pods  â”‚               â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚               â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ PyTorchJob â”‚  â”‚  â”‚  â”‚  vLLM      â”‚  â”‚               â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ (Kubeflow) â”‚  â”‚  â”‚  â”‚ TGI/DJL    â”‚  â”‚               â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚               â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚           HyperPod ê´€ë¦¬ ì»´í¬ë„ŒíŠ¸                      â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Inference Operator (ì¶”ë¡  ë°°í¬ ìë™í™”)              â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Task Governance (ë¦¬ì†ŒìŠ¤ í• ë‹¹ ê´€ë¦¬)                 â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Health Monitoring Agent (ë…¸ë“œ ë³µêµ¬)                â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Karpenter (ì˜¤í† ìŠ¤ì¼€ì¼ë§)                           â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚              GPU Worker Nodes                        â”‚  â”‚
â”‚  â”‚  â”‚  ml.p5.48xlarge (H100), ml.g5.12xlarge (A10G)        â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ NVIDIA Device Plugin                              â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ EFA (Elastic Fabric Adapter) ë„¤íŠ¸ì›Œí¬              â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ FSx for Lustre / S3 CSI ë§ˆìš´íŠ¸                     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     Storage Layer                          â”‚  â”‚
â”‚  â”‚  â€¢ FSx for Lustre (ê³µìœ  ê³ ì„±ëŠ¥ ìŠ¤í† ë¦¬ì§€)                   â”‚  â”‚
â”‚  â”‚  â€¢ S3 CSI Driver (S3 ì§ì ‘ ì ‘ê·¼)                            â”‚  â”‚
â”‚  â”‚  â€¢ EBS (Persistent Volume)                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë°ì´í„° íë¦„

```
í›ˆë ¨ ì›Œí¬í”Œë¡œìš°:
ì‚¬ìš©ì â†’ kubectl apply -f pytorchjob.yaml â†’ Kubeflow Operator â†’
  â†’ Pod ìŠ¤ì¼€ì¤„ë§ â†’ FSxì—ì„œ ë°ì´í„° ë¡œë“œ â†’ ë¶„ì‚° í›ˆë ¨ â†’ ì²´í¬í¬ì¸íŠ¸ ì €ì¥

ì¶”ë¡  ì›Œí¬í”Œë¡œìš°:
ì‚¬ìš©ì â†’ kubectl apply -f inferenceendpoint.yaml â†’ Inference Operator â†’
  â†’ S3/FSxì—ì„œ ëª¨ë¸ ë¡œë“œ â†’ vLLM/TGI ì„œë²„ ì‹œì‘ â†’ ALB í”„ë¡œë¹„ì €ë‹ â†’
  â†’ HTTPS ì—”ë“œí¬ì¸íŠ¸ ì œê³µ
```

---

## Slurm vs EKS ë¹„êµ

HyperPodëŠ” ë‘ ê°€ì§€ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ë°©ì‹ì„ ì§€ì›í•©ë‹ˆë‹¤. ì›Œí¬ë¡œë“œ íŠ¹ì„±ì— ë”°ë¼ ì„ íƒí•˜ì„¸ìš”.

| ë¹„êµ í•­ëª© | Slurm (HPC ì „í†µ) | EKS (Kubernetes) |
|----------|------------------|------------------|
| **ì‚¬ìš© ì‚¬ë¡€** | ëŒ€ê·œëª¨ ì‚¬ì „ í›ˆë ¨ (100B+ ëª¨ë¸) | íŒŒì¸íŠœë‹, ì¶”ë¡ , MLOps íŒŒì´í”„ë¼ì¸ |
| **ì‘ì—… ì œì¶œ** | `sbatch script.sbatch` | `kubectl apply -f job.yaml` |
| **ë¦¬ì†ŒìŠ¤ ê´€ë¦¬** | Partition, QoS | Namespace, ResourceQuota |
| **ìŠ¤ì¼€ì¤„ë§** | Backfill, Gang Scheduling | Karpenter, Kueue |
| **ëª¨ë‹ˆí„°ë§** | squeue, sacct | Prometheus, CloudWatch |
| **ì»¨í…Œì´ë„ˆ** | Pyxis+Enroot (ì„ íƒ) | ë„¤ì´í‹°ë¸Œ ì§€ì› |
| **ìë™ ìŠ¤ì¼€ì¼ë§** | ì œí•œì  | Karpenterë¡œ ë™ì  ë…¸ë“œ ì¶”ê°€/ì œê±° |
| **ì¶”ë¡  ë°°í¬** | ìˆ˜ë™ ì„¤ì • í•„ìš” | Inference Operator ìë™í™” |
| **í•™ìŠµ ê³¡ì„ ** | HPC ê²½í—˜ í•„ìš” | Kubernetes ê²½í—˜ í™œìš© ê°€ëŠ¥ |
| **ìƒíƒœê³„** | MPI, NCCL, EFA | Kubeflow, KServe, Ray |